---
title: "Seattle Airbnb"
output: pdf_document
---

By Yiming Sun

This exploration is based on a dataset that describes the listing activity of homestays in Seattle, WA , which could be found here:https://www.kaggle.com/airbnb/seattle

After reading my analysis, you would have a better understanding of the airbnb industry in Seattle.
If you are interested in becoming an airbnb host, you could also gain an insight on either how to become a "super host" or set the right price for your properties.

#Data Preparation
The dataset size was 21MB with 3818 rows. I dropped some unrelevant columns before loading it here.
```{r}
library(readr)
listings <- read_csv('/Users/yimingsun/Desktop/r/listings.csv',na='.')
```

check and remove missing values
```{r}

library(Amelia)
missmap(listings[-1],col=c('grey','steelblue'),y.cex=0.5,x.cex=0.5)
```

Remove the rows with missing values in variables that are important
```{r}
listings=subset(listings, host_response_rate!="")
listings=subset(listings, host_about!="")
listings=subset(listings, bathrooms!="")
listings=subset(listings, host_is_superhost!="")
listings=subset(listings, bedrooms!="")
listings=subset(listings, select=-c(review_scores_rating))#it seems that there are lots of missing values for the 'review_scores_rating' variable, and we might run into endogeneity issues to put it into the superhost regression. So we remove this variable here.
```


I also need to check variability
```{r}
library(tidyverse)
library(ggplot2)
listings %>% ggplot() + geom_bar(aes(host_response_time))
listings %>% ggplot() + geom_bar(aes(host_is_superhost))
listings %>% ggplot() + geom_bar(aes(neighbourhood_group_cleansed))
#all good here
```


#Before we start explore the ways to become a superhost.Let's visualize the key words of Seattle's airbnb hosts and their property descriptions. Just for fun.
install packages
```{r}
library(tm)
library(NLP)
library(wordcloud)
library(SnowballC)
```


build a corpus for text mining
```{r}
as.character(listings$host_about)
host=str_replace_all(listings$host_about,"[^[:alpha:]]", " ") 
corp <- Corpus(VectorSource(host))
inspect(corp)
```
clean and pre-process the text data
```{r}

corp <- tm_map(corp, removeNumbers)
corp<- tm_map(corp, removePunctuation)
corp <- tm_map(corp, stripWhitespace) 
corp<- tm_map(corp, tolower) #transform into low case
corp <- tm_map(corp, removeWords, stopwords("english")) 
corp<- tm_map(corp,removeWords, c("i","we","live","living","seattle","washington","airbnb"))#remove your own stop word
inspect(corp)
```


Generate the spreadsheet representation of the documents.
```{r}
tdm <- DocumentTermMatrix(corp)
inspect(tdm)
```

ready for the word cloud? I saw love seattle on the first sight.
```{r}
m <- as.matrix(tdm)

# find out the importance of each term by summing up the tf-idf scores over the corpus
importance <- data.frame(sort(colSums(m),decreasing=TRUE))
set.seed(111)
wordcloud(rownames(importance), importance[,1], max.words=200, random.order=FALSE, rot.per=0.35,colors=brewer.pal(8, "Dark2"))

```

##Let's use logistic regression to explore the key elements of becoming a super host in Seattle
```{r}
#generate a new column to show the time length of the host joined the airbnb
str(listings$host_since)
listings$host_since= as.Date(listings$host_since, format = "%m/%d/%Y")
length= difftime("0016-01-04",listings$host_since, unit = "days")
length<-round(length)
View(length)
listings<-cbind(listings,length)
```

select predicting variables
```{r}
select.var <-c(8,9,10,11,15,16,17,18,19,22,23)
train.index <- sample(1:nrow(listings), 0.7*nrow(listings))
train.df <- listings[train.index, select.var]
```

test correlation between numeric variables
```{r}
#let's transform the data type first
str(train.df)
train.df$host_response_rate<-as.numeric(gsub("\\%", "",train.df$host_response_rate))
train.df$length<-as.numeric(train.df$length)

test.var<-c(2,7,8,9,11)
testdata<-train.df[test.var]
cor(testdata)
#the bathrooms and bedrooms and beds those three factors are highly corelated, let's just keep one: bedrooms
#so we need to update the train.df and valid.df
select.var2 <-c(8,9,10,11,15,16,18,22,23)
train.index2 <- sample(1:nrow(listings), 0.7*nrow(listings))
train2.df <- listings[train.index, select.var2]
valid2.df <- listings[-train.index,select.var2]
str(train2.df)
train2.df$host_response_rate<-as.numeric(gsub("\\%", "",train2.df$host_response_rate))
train2.df$length<-as.numeric(train2.df$length)
```




set the base
```{r}
train2.df$host_response_time<-as.factor(train2.df$host_response_time)
train2.df$neighbourhood_group_cleansed<-as.factor(train2.df$neighbourhood_group_cleansed)
train2.df$property_type<-as.factor(train2.df$property_type)
train2.df$room_type<-as.factor(train2.df$room_type)
train2.df$cancellation_policy<-as.factor(train2.df$cancellation_policy)
train2.df$host_response_time <- relevel(train2.df$host_response_time, ref = "within an hour")
train2.df$neighbourhood_group_cleansed<- relevel(train2.df$neighbourhood_group_cleansed, ref = "University District")
train2.df$property_type <- relevel(train2.df$property_type, ref = "Apartment")
train2.df$room_type<-relevel(train2.df$room_type,ref = "Entire home/apt")
train2.df$cancellation_policy<-relevel(train2.df$cancellation_policy,ref = "flexible")
str(train2.df)

```

transform prediction variable into 0/1
```{r}
train2.df$host_is_superhost <- as.factor (train2.df$host_is_superhost) 
levels(train2.df$host_is_superhost)<-c(0,1)
names(train2.df$host_is_superhost)[2] <- "is_superhost"

```


```{r}
model <- glm(train2.df$host_is_superhost~.,family=binomial,data=train2.df)
summary(model)
#we could notice that a quicker response time and a stricter canllcelation policy would lead to a higher probablity of becoming a superhost. Host with properties in University District are the least possible to become a superhost. Property type cabin is significantly better than apartment,sharedroom type is significantly worse than entire home/apt. And the host's length of joining airbnb doesn't play an important role in effecting whether the host would become a superhost. And a surprising result is that more bedrooms tend to decrease the host's probability of becoming a superhost. I think it might be a lurking variable here. Perhaps more bedrooms tend to be more less affordable and that might be the reason to decrease the property's popularity. 
```

validation
```{r}
valid2.df$host_response_rate<-as.numeric(gsub("\\%", "",valid2.df$host_response_rate))
valid2.df$length<-as.numeric(valid2.df$length)
str(valid2.df)
library(caret)
model.pred <- predict(model,valid2.df,type='response')
pred<-ifelse(model.pred>0.5,"t","f")
confusionMatrix(factor(pred),factor(valid2.df$host_is_superhost))
#our prediction power here is great!
```



